#!/usr/bin/perl -w
# locates files using the 'locate' utility (Perl)

use Term::ANSIColor qw(:constants);
use File::Basename;

my $regexp;
my $number;
my $counter=0;
my @dirs;
my $aux;
my $oldaux="";
$regexp=$ARGV[0];
$number=$ARGV[1];
if (!$regexp) { print("echo Usage: golocate regex [num]"); exit(0); };

@lines=`locate $regexp`;

if (!@lines) { print("echo No files matching $regexp found."); exit(1);}

if (!$number) { print "echo -e ";}

for $line (@lines)
  {
    chomp($line);

    if (-d $line) {
      $aux=$line;
    }
    else {
      $aux=dirname($line);
    };
    if ($aux  ne $oldaux) {
	$counter++;
	push @dirs, $aux;
	if (!$number) {
	  print BOLD $counter." ".$aux."\n";
	  print RESET;
	};
      };
    if ((!$number) && ($dirs[-1] ne $line)) {
	print "\t".basename($line)."\n";
      };

    $oldaux=$aux;
   };

if ($number) {
  if ( $number>= $counter+1) {
    print("echo Your number is too big!\n"); exit(1);
  };
    print "cd $dirs[$number-1]\n";
};

print "";
