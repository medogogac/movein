#!/usr/bin/env python3
# syncs the papers dir with feller
import os
import sys
# import termcolor
# from termcolor import colored
import argparse
from os.path import expanduser, expandvars

####################################################
# Argument parsing and default values
####################################################

# default values; expanduser() makes sure that ~ gets expanded correctly
gm=os.environ["gmac"]
REMOTE=gm+":~/papers"
# LOCAL=expanduser("~/papers")
# LOCAL=expanduser("~/winhome/Documents/papers")
LOCAL=expandvars("$PAPERSDIR")



# argument parsing
argumentparser = argparse.ArgumentParser(description="sync the papers folder with the original in "+REMOTE)
argumentparser.add_argument("-v","--verbose",
  help="verbose output", action="store_true")
argumentparser.add_argument("--forreal", help='fo it for real, not only a dry run',action="store_true")
argumentparser.add_argument("-g","--get", help='get', action="store_true")
argumentparser.add_argument("-p","--put", help='put', action="store_true")

argumentparser.add_argument("-d","--delete",
  help="delete extra files",
  action="store_true"
  )

arg=argumentparser.parse_args()

if arg.verbose:
    print("Remote           :"+REMOTE)
    print("Local            :"+LOCAL)
    if arg.get:
        print ("Getting ... ")
    if arg.put:
        print ("Putting ... ")
    if arg.delete:
        print ("Also deleting ...")
    if arg.forreal:
        print ("... and doing it for real!")
    else:
        print ("... but only a dry run.")

flags ="-azv -e ssh -P "
if not arg.forreal:
    flags+="--dry-run "
if arg.delete:
    flags+="--delete "


if arg.put:
    soutar=LOCAL+"/ "+REMOTE
else:
    if arg.get:
        soutar=REMOTE+"/ "+LOCAL
    else:
        soutar=""

if soutar == "":
    print("Specify either --put (-p) or --get (-g)")
    sys.exit(1)

command="rsync "+flags+soutar
print(command)
os.system(command)

